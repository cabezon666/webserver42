# Default Webserv Configuration
# This is the main configuration file for the webserver

# Main server block - handles default requests
server {
    # Network configuration
    listen 8080
    host 0.0.0.0
    server_name localhost webserv.local

    # Request limits
    client_max_body_size 10485760  # 10MB in bytes

    # Error pages
    error_page 404 www/error/404.html
    error_page 500 www/error/500.html

    # Default location - serves static files
    location / {
        root www
        index index.html
        allow GET
        autoindex off
    }

    # Upload directory with POST support
    location /upload {
        root www/uploads
        allow GET POST DELETE
        upload_path www/uploads
        client_max_body_size 5242880  # 5MB limit for uploads
    }

    # Public directory with directory listing enabled
    location /public {
        root www/public
        allow GET
        autoindex on
        index index.html
    }

    # CGI scripts location for PHP
    location .php {
        root www
        allow GET POST
        cgi_path /usr/bin/php-cgi
        cgi_extension .php
    }

    # CGI scripts location for Python
    location .py {
        root www/cgi-bin
        allow GET POST
        cgi_path /usr/bin/python3
        cgi_extension .py
    }

    # Redirect example
    location /old-page {
        return /new-page
    }

    # Protected area (returns 403)
    location /admin {
        root www/admin
        allow GET
        index admin.html
    }
}

# Secondary server on different port
server {
    listen 8081
    host 0.0.0.0
    server_name api.webserv.local

    client_max_body_size 1048576  # 1MB

    # API endpoints
    location /api {
        root www/api
        allow GET POST PUT DELETE
        index api.html
    }

    # Health check endpoint
    location /health {
        root www
        allow GET
        index health.html
    }
}

# Development server with debug features
server {
    listen 8082
    host 127.0.0.1
    server_name dev.webserv.local

    # Enable directory listing for development
    location / {
        root www
        allow GET POST DELETE
        autoindex on
        index index.html
    }

    # Test area with all features enabled
    location /test {
        root www/test
        allow GET POST DELETE
        autoindex on
        cgi_path /usr/bin/python3
        cgi_extension .py
        upload_path www/test/uploads
    }
}
